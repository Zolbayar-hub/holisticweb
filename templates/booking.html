
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holistic Services Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f4f8;
        }
        .calendar-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            gap: 2rem;
            padding: 2rem;
        }
        .main-content {
            flex: 3;
        }
        .sidebar {
            flex: 1;
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .flatpickr-calendar {
            margin-top: 1rem;
        }
        #reminders {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #fff;
            border-radius: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
        }
        @media (max-width: 768px) {
            .calendar-container {
                flex-direction: column;
            }
            .sidebar {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <div class="calendar-container">
        <!-- Main Content: Booking Calendar and Services -->
        <div class="main-content">
            <h1 class="text-3xl font-bold text-gray-800 mb-6">Book Your Holistic Session</h1>
            
            <!-- Service Selection -->
            <div class="mb-6">
                <label for="service" class="block text-lg font-medium text-gray-700 mb-2">Select a Service</label>
                <select id="service" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="" disabled selected>Choose a holistic service</option>
                    <option value="yoga">Yoga Session (60 min)</option>
                    <option value="meditation">Guided Meditation (45 min)</option>
                    <option value="reiki">Reiki Healing (60 min)</option>
                    <option value="massage">Holistic Massage (60 min)</option>
                </select>
            </div>
            
            <!-- User Information -->
            <div class="mb-6">
                <label for="user-name" class="block text-lg font-medium text-gray-700 mb-2">Your Name</label>
                <input type="text" id="user-name" placeholder="Enter your full name" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="mb-6">
                <label for="user-phone" class="block text-lg font-medium text-gray-700 mb-2">Contact Phone</label>
                <input type="tel" id="user-phone" placeholder="Enter your phone number" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <!-- Calendar -->
            <div class="mb-6">
                <label class="block text-lg font-medium text-gray-700 mb-2">Select a Date</label>
                <input type="text" id="calendar" placeholder="Click to select a date" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            
            <!-- Time Slots -->
            <div class="mb-6">
                <label class="block text-lg font-medium text-gray-700 mb-2">Available Time Slots</label>
                <div id="time-slots" class="grid grid-cols-2 gap-4">
                    <!-- Time slots will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Booking Button -->
            <button id="book-now" class="w-full bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition duration-300">Book Now</button>
            
            <!-- Confirmation Message -->
            <div id="confirmation" class="mt-4 text-green-600 hidden"></div>
            
            <!-- Reminders Display (for demo) -->
            <div id="reminders" class="hidden">
                <h3 class="text-lg font-medium text-gray-700 mb-2">Sent Reminders</h3>
                <div id="reminder-list"></div>
            </div>
        </div>
        
        <!-- Sidebar: Contact Information -->
        <div class="sidebar">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4">Contact Us</h2>
            <p class="text-gray-600 mb-2"><strong>Phone:</strong> (312) 626 0832</p>
            <p class="text-gray-600 mb-2"><strong>Email:</strong> yourmail.com</p>
            <p class="text-gray-600 mb-2"><strong>Address:</strong> Your Address</p>
            <p class="text-gray-600 mb-4"><strong>Hours:</strong> Mon-Fri, 9 AM - 6 PM</p>
            <a href="mailto:info@holisticwellness.com" class="text-blue-600 hover:underline">Send us an email</a>
        </div>
    </div>

    <script>
        // Initialize Flatpickr calendar
        flatpickr("#calendar", {
            dateFormat: "Y-m-d",
            minDate: "today",
            maxDate: new Date().fp_incr(30), // Allow booking up to 30 days in advance
            onChange: function(selectedDates, dateStr) {
                populateTimeSlots(dateStr);
            }
        });

        // Service durations in minutes
        const serviceDurations = {
            yoga: 60,
            meditation: 45,
            reiki: 60,
            massage: 60
        };

        // Sample time slots (30-minute intervals)
        const timeSlots = [
            "09:00 AM", "09:30 AM", "10:00 AM", "10:30 AM",
            "11:00 AM", "11:30 AM", "12:00 PM", "12:30 PM",
            "01:00 PM", "01:30 PM", "02:00 PM", "02:30 PM",
            "03:00 PM", "03:30 PM", "04:00 PM", "04:30 PM",
            "05:00 PM"
        ];

        // Store bookings (in-memory for demo)
        let bookings = [];

        // Convert time string to minutes since midnight for comparison
        function timeToMinutes(timeStr) {
            const [time, period] = timeStr.split(" ");
            let [hours, minutes] = time.split(":").map(Number);
            if (period === "PM" && hours !== 12) hours += 12;
            if (period === "AM" && hours === 12) hours = 0;
            return hours * 60 + minutes;
        }

        // Convert date and time to timestamp
        function getAppointmentTimestamp(dateStr, timeStr) {
            const [year, month, day] = dateStr.split("-").map(Number);
            const minutes = timeToMinutes(timeStr);
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return new Date(year, month - 1, day, hours, mins).getTime();
        }

        // Check if a time slot is available
        function isSlotAvailable(date, startTime, duration) {
            const startMinutes = timeToMinutes(startTime);
            const endMinutes = startMinutes + duration;

            return !bookings.some(booking => {
                if (booking.date !== date) return false;
                const bookedStart = timeToMinutes(booking.time);
                const bookedEnd = bookedStart + booking.duration;
                return (startMinutes < bookedEnd && endMinutes > bookedStart);
            });
        }

        // Populate time slots
        function populateTimeSlots(date) {
            const timeSlotsContainer = document.getElementById("time-slots");
            timeSlotsContainer.innerHTML = "";
            const service = document.getElementById("service").value;
            if (!date || !service) {
                timeSlotsContainer.innerHTML = "<p class='text-gray-600'>Please select a service and date.</p>";
                return;
            }

            const duration = serviceDurations[service];
            timeSlots.forEach(slot => {
                const button = document.createElement("button");
                button.textContent = slot;
                button.className = "p-2 border rounded-lg transition duration-300 text-left";
                if (isSlotAvailable(date, slot, duration)) {
                    button.classList.add("hover:bg-blue-100", "text-gray-800");
                    button.addEventListener("click", () => selectTimeSlot(slot, date));
                } else {
                    button.textContent += " (Booked)";
                    button.classList.add("bg-gray-200", "text-gray-500", "cursor-not-allowed");
                    button.disabled = true;
                }
                timeSlotsContainer.appendChild(button);
            });
        }

        // Handle service change
        document.getElementById("service").addEventListener("change", () => {
            const date = document.getElementById("calendar").value;
            if (date) populateTimeSlots(date);
        });

        // Handle time slot selection
        let selectedTime = null;
        function selectTimeSlot(slot, date) {
            selectedTime = slot;
            document.querySelectorAll("#time-slots button").forEach(btn => {
                btn.classList.remove("bg-blue-200");
                if (btn.textContent === slot) {
                    btn.classList.add("bg-blue-200");
                }
            });
        }

        // Simulate sending SMS reminder
        function sendReminder(booking) {
            const reminderMessage = `Reminder: ${booking.userName}, your ${booking.service} appointment is today (${booking.date}) at ${booking.time}.`;
            console.log(`SMS to ${booking.userPhone}: ${reminderMessage}`);
            // Display reminder on page for demo
            const reminderList = document.getElementById("reminder-list");
            const reminderItem = document.createElement("p");
            reminderItem.className = "text-sm text-gray-600 mb-1";
            reminderItem.textContent = `[Demo SMS] ${reminderMessage}`;
            reminderList.appendChild(reminderItem);
            document.getElementById("reminders").classList.remove("hidden");
        }

        // Schedule reminders
        function scheduleReminder(booking) {
            const appointmentTime = getAppointmentTimestamp(booking.date, booking.time);
            const reminderTime = appointmentTime - 60 * 60 * 1000; // 1 hour before
            const currentTime = new Date().getTime();
            const delay = reminderTime - currentTime;

            if (delay > 0) {
                setTimeout(() => {
                    sendReminder(booking);
                }, delay);
            } else if (delay > -60 * 60 * 1000) {
                // If appointment is within the next hour, send reminder immediately
                sendReminder(booking);
            }
        }

        // Handle booking
        document.getElementById("book-now").addEventListener("click", () => {
            const service = document.getElementById("service").value;
            const date = document.getElementById("calendar").value;
            const userName = document.getElementById("user-name").value.trim();
            const userPhone = document.getElementById("user-phone").value.trim();
            const confirmation = document.getElementById("confirmation");

            if (!service || !date || !selectedTime || !userName || !userPhone) {
                confirmation.textContent = "Please fill in all fields: service, date, time slot, name, and phone number.";
                confirmation.classList.remove("text-green-600", "hidden");
                confirmation.classList.add("text-red-600");
                return;
            }

            // Basic phone number validation
            const phoneRegex = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
            if (!phoneRegex.test(userPhone)) {
                confirmation.textContent = "Please enter a valid phone number (e.g., 123-456-7890).";
                confirmation.classList.remove("text-green-600", "hidden");
                confirmation.classList.add("text-red-600");
                return;
            }

            const duration = serviceDurations[service];
            if (!isSlotAvailable(date, selectedTime, duration)) {
                confirmation.textContent = "Selected time slot is no longer available.";
                confirmation.classList.remove("text-green-600", "hidden");
                confirmation.classList.add("text-red-600");
                populateTimeSlots(date);
                return;
            }

            const booking = { date, time: selectedTime, duration, service, userName, userPhone };
            bookings.push(booking);
            confirmation.textContent = `Booking confirmed for ${userName} (${userPhone}) for ${service} on ${date} at ${selectedTime} (ends at ${addMinutesToTime(selectedTime, duration)})!`;
            confirmation.classList.remove("text-red-600", "hidden");
            confirmation.classList.add("text-green-600");

            // Schedule reminder
            scheduleReminder(booking);

            // Reset form
            document.getElementById("service").value = "";
            document.getElementById("calendar").value = "";
            document.getElementById("user-name").value = "";
            document.getElementById("user-phone").value = "";
            selectedTime = null;
            document.getElementById("time-slots").innerHTML = "";
        });

        // Helper function to calculate end time
        function addMinutesToTime(timeStr, minutesToAdd) {
            const minutes = timeToMinutes(timeStr) + minutesToAdd;
            let hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            const period = hours >= 12 ? "PM" : "AM";
            hours = hours % 12 || 12;
            return `${hours}:${mins.toString().padStart(2, "0")} ${period}`;
        }

        // Simulate current time updates for testing reminders
        function checkReminders() {
            const currentTime = new Date().getTime();
            bookings.forEach(booking => {
                const appointmentTime = getAppointmentTimestamp(booking.date, booking.time);
                const reminderTime = appointmentTime - 60 * 60 * 1000;
                if (Math.abs(currentTime - reminderTime) < 60 * 1000) {
                    sendReminder(booking);
                }
            });
        }

        // Check reminders every minute
        setInterval(checkReminders, 60 * 1000);
    </script>
</body>
</html>